(function ($) { $.extend($, { contains: function (parent, node) { return parent.compareDocumentPosition ? !!(parent.compareDocumentPosition(node) & 16) : parent !== node && parent.contains(node) } }) })(Zepto); (function ($, undefined) { $.extend($, { toString: function (obj) { return Object.prototype.toString.call(obj) }, slice: function (array, index) { return Array.prototype.slice.call(array, index || 0) }, later: function (fn, when, periodic, context, data) { return window["set" + (periodic ? "Interval" : "Timeout")](function () { fn.apply(context, data) }, when || 0) }, parseTpl: function (str, data) { var tmpl = "var __p=[],print=function(){__p.push.apply(__p,arguments);};" + "with(obj||{}){__p.push('" + str.replace(/\\/g, "\\\\").replace(/'/g, "\\'").replace(/<%=([\s\S]+?)%>/g, function (match, code) { return "'," + code.replace(/\\'/g, "'") + ",'" }).replace(/<%([\s\S]+?)%>/g, function (match, code) { return "');" + code.replace(/\\'/g, "'").replace(/[\r\n\t]/g, " ") + "__p.push('" }).replace(/\r/g, "\\r").replace(/\n/g, "\\n").replace(/\t/g, "\\t") + "');}return __p.join('');"; var func = new Function("obj", tmpl); return data ? func(data) : func }, throttle: function (delay, fn, debounce_mode) { var last = 0, timeId; if (typeof fn !== "function") { debounce_mode = fn; fn = delay; delay = 250 } function wrapper() { var that = this, period = Date.now() - last, args = arguments; function exec() { last = Date.now(); fn.apply(that, args) } function clear() { timeId = undefined } if (debounce_mode && !timeId) { exec() } timeId && clearTimeout(timeId); if (debounce_mode === undefined && period > delay) { exec() } else { timeId = setTimeout(debounce_mode ? clear : exec, debounce_mode === undefined ? delay - period : delay) } } wrapper._zid = fn._zid = fn._zid || $.proxy(fn)._zid; return wrapper }, debounce: function (delay, fn, t) { return fn === undefined ? $.throttle(250, delay, false) : $.throttle(delay, fn, t === undefined ? false : t !== false) } }); $.each("String Boolean RegExp Number Date Object Null Undefined".split(" "), function (i, name) { var fn; if ("is" + name in $) { return } switch (name) { case "Null": fn = function (obj) { return obj === null }; break; case "Undefined": fn = function (obj) { return obj === undefined }; break; default: fn = function (obj) { return new RegExp(name + "]", "i").test(toString(obj)) } } $["is" + name] = fn }); var toString = $.toString })(Zepto); (function ($, undefined) { var ua = navigator.userAgent, na = navigator.appVersion, br = $.browser; $.extend(br, { qq: /qq/i.test(ua), uc: /UC/i.test(ua) || /UC/i.test(na) }); br.uc = br.uc || !br.qq && !br.chrome && !br.firefox && !/safari/i.test(ua); try { br.version = br.uc ? na.match(/UC(?:Browser)?\/([\d.]+)/)[1] : br.qq ? ua.match(/MQQBrowser\/([\d.]+)/)[1] : br.version } catch (e) { } $.support = $.extend($.support || {}, { orientation: !(br.uc || (parseFloat($.os.version) < 5 && (br.qq || br.chrome))) && !($.os.android && parseFloat($.os.version) > 3) && "orientation" in window && "onorientationchange" in window, touch: "ontouchend" in document, cssTransitions: "WebKitTransitionEvent" in window, has3d: "WebKitCSSMatrix" in window && "m11" in new WebKitCSSMatrix() }) })(Zepto); (function ($) { $.matchMedia = (function () { var mediaId = 0, cls = "gmu-media-detect", transitionEnd = $.fx.transitionEnd, cssPrefix = $.fx.cssPrefix, $style = $("<style></style>").append("." + cls + "{" + cssPrefix + "transition: width 0.001ms; width: 0; position: relative; bottom: -999999px;}\n").appendTo("head"); return function (query) { var id = cls + mediaId++, $mediaElem = $('<div class="' + cls + '" id="' + id + '"></div>').appendTo("body"), listeners = [], ret; $style.append("@media " + query + " { #" + id + " { width: 100px; } }\n"); $mediaElem.on(transitionEnd, function () { ret.matches = $mediaElem.width() === 100; $.each(listeners, function (i, fn) { $.isFunction(fn) && fn.call(ret, ret) }) }); ret = { matches: $mediaElem.width() === 100, media: query, addListener: function (callback) { listeners.push(callback); return this }, removeListener: function (callback) { var index = listeners.indexOf(callback); ~index && listeners.splice(index, 1); return this } }; return ret } }()); $(function () { var handleOrtchange = function (mql) { if (state !== mql.matches) { $(window).trigger("ortchange"); state = mql.matches } }, state = true; $.mediaQuery = { ortchange: "screen and (width: " + window.innerWidth + "px)" }; $.matchMedia($.mediaQuery.ortchange).addListener(handleOrtchange) }); function _registerScrollStop() { $(window).on("scroll", $.debounce(80, function () { $(document).trigger("scrollStop") }, false)) } function _touchstartHander() { $(window).off("scroll"); _registerScrollStop() } _registerScrollStop(); $(window).on("pageshow", function (e) { if (e.persisted) { $(document).off("touchstart", _touchstartHander).one("touchstart", _touchstartHander) } }) })(Zepto);